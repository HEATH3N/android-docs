<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Offline | Android Documentation</title><meta name="type" data-type="enum" content="Android Documentation"/><meta name="title" data-type="string" content="Offline | Android Documentation"/><link href="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.min.css" rel="stylesheet"/><script async="" defer="" src="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.js"></script><link href="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.min.css" rel="stylesheet"/><script src="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.js"></script><link rel="stylesheet" href="stylesheet.css" type="text/css"/><style>.border--3{border-width:3px!important}.bg-green{background-color:#8cca44!important}.icon-android-green svg{color:#8cca44}.bright-blue-color{color:#0082ff}.bright-blue-color-on-hover:hover{color:#0082ff!important}.border--bright-blue-color{border-color:#273d56}.border--gray-less-faint{border-color:#e8ebee!important}.bright-blue-color-on-hover-anchor a:hover{color:#0082ff}.hmax130 img{max-height:130px}.wmax260{max-width:260px}.text-decoration-none{text-decoration:none!important}.unstyled-list li{list-style-type:none!important}.overflow-y{overflow-y:auto}.t48{top:48px}.b0{bottom:0}.txt-ms{font-size:13px!important;line-height:18px}.limiter{padding-left:24px;padding-right:24px;width:100%}@media (min-width:1200px){.limiter{padding-left:12.5%!important;padding-right:12.5%!important}}.prose h1,h2,h3,h4,h5,h6{font-weight:400!important}@media (min-width:440px){.note-card{margin-top:-12px;width:240px;margin-left:24px;padding-bottom:24px}}code,pre{font-family:Fira Mono Medium,Monaco,monospace!important;font-weight:700!important;font-size:12px!important;word-break:normal!important}pre{background-color:#232323!important}.doc-ul>.doc-ul-item:before{content:"";width:8px;height:8px;border-radius:2px;border:1px solid #1f3349;opacity:.4;position:absolute;margin:9px 0 0 -20px}.doc-ol{counter-reset:listItem}.doc-ol>.doc-ol-item{margin:3px 0}ol li{list-style-type:none}ol li:before{counter-increment:listItem;content:counter(listItem);font-size:12px;border-radius:3px;padding:1px 6px;border:1px solid #c6d2e1;margin-right:12px}.hljs{color:#a9b7c6;background:#232323;display:block;overflow-x:auto;padding:.5em}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#56b881}.hljs-comment,.hljs-quote{color:gray}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#56b881}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><div id="react-mount"><div class="grid" data-reactroot="" data-reactid="1" data-react-checksum="114485138"><div class="z1 min48 flex-parent--center-main flex-parent w-full border-b border-t bg-white border--gray-less-faint fixed" data-reactid="2"><div class="wmax1200 w-full pl24 pr24 flex-parent--space-between-main flex-parent" data-reactid="3"><div class="flex-child col col--6 inline-block" data-reactid="4"><div class="txt-s py12 bg-transparent btn px0 color-gray-light" data-reactid="5"><strong data-reactid="6">Platform</strong></div><div class="txt-s py12 bg-transparent btn  color-gray-dark" data-reactid="7"><strong data-reactid="8">Android</strong></div><div class="txt-s py12 bg-transparent btn px0 color-gray-light" data-reactid="9"><strong data-reactid="10">Product</strong></div><div style="display:inline-block;" data-reactid="11"><button class="txt-s py12 border--bright-blue-color bright-blue-color-on-hover bg-transparent btn flex-parent flex-parent--center-cross color-gray-dark" data-reactid="12"><strong data-reactid="13">Map SDK</strong><svg class="icon" data-reactid="14"><use xlink:href="#icon-chevron-down" data-reactid="15"></use></svg></button></div></div><div class="flex-child col col--6 flex-parent flex-parent--end-main" data-reactid="16"><a class="py12 transition mobile-right-nav unround btn color-gray-dark border--bright-blue-color bright-blue-color-on-hover bg-transparent txt-s  border-b border--3" href="/android-docs/map-sdk/overview/" data-reactid="17">Overview</a><a class="py12 transition mobile-right-nav unround btn color-gray-dark border--bright-blue-color bright-blue-color-on-hover bg-transparent txt-s  " href="/android-docs/map-sdk/examples/" data-reactid="18">Examples</a><a class="py12 transition mobile-right-nav unround btn color-gray-dark border--bright-blue-color bright-blue-color-on-hover bg-transparent txt-s  " href="/android-docs/map-sdk/tutorials/" data-reactid="19">Tutorials</a></div></div></div><div class="scroll-styled flex-parent--center-main flex-parent limiter pb96 pl24 pr24 pt24 overflow-y t48 b0 fixed flex-child" data-reactid="20"><div class="flex-parent--space-between-main flex-parent" data-reactid="21"><div class="col col--2 pt42 pr18 pb18 flex-child--no-shrink fixed color-gray-dark unstyled-list scroll-styled" data-reactid="22"><div data-reactid="23"><li class="txt-bold txt-fancy" data-reactid="24"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/map-sdk/overview/" data-reactid="25">Map SDK</a></li><!-- react-text: 26 --><!-- /react-text --></div><div data-reactid="27"><li class="txt-bold txt-fancy" data-reactid="28"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/map-sdk/overview/styling-map/" data-reactid="29">Styling the map</a></li><!-- react-text: 30 --><!-- /react-text --></div><div data-reactid="31"><li class="txt-bold txt-fancy" data-reactid="32"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/map-sdk/overview/annotations/" data-reactid="33">Annotations</a></li><!-- react-text: 34 --><!-- /react-text --></div><div data-reactid="35"><li class="txt-bold txt-fancy" data-reactid="36"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/map-sdk/overview/offline/" data-reactid="37"><div class="bright-blue-color" data-reactid="38">Offline</div></a></li><div class="ml6 pt6" data-reactid="39"><ul class="txt-s inline-block mb12 bright-blue-color-on-hover-anchor">
<li>
<ul>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#defining-a-region">Defining a region</a></li>
<li><a href="#download-a-region">Download a region</a></li>
<li><a href="#managing-downloaded-regions">Managing downloaded regions</a></li>
<li><a href="#delete-region">Delete region</a></li>
</ul>
</li>
</ul>
</div></div><div data-reactid="40"><li class="txt-bold txt-fancy" data-reactid="41"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/map-sdk/overview/runtime-styling/" data-reactid="42">Runtime Styling</a></li><!-- react-text: 43 --><!-- /react-text --></div><!-- react-text: 44 --><!-- /react-text --><div class="flex-parent wmin180 pb12 flex-parent--column" data-reactid="45"><a href="/android-docs/api/map-sdk/5.0.2/index.html" class="txt-fancy bright-blue-color-on-hover" data-reactid="46">API Reference</a></div><!-- react-text: 47 --><!-- /react-text --></div><div data-reactid="48"><div class="prose color-gray-dark" data-reactid="49"><div class="content col--9 col col--offl3" data-reactid="50"><div class="pt12 doc-ul doc-ol pb96 wmax1200 doc-ol-item" data-reactid="51"><div class="markdown" data-reactid="52"><div data-reactid="53"><h1 id="offline"><a class="markdownIt-Anchor" href="#offline"></a> Offline</h1>
<p>Often, you might find your user base spends most of its time off the grid. The Maps SDK enables you to download and store pre-selected regions for usage when the device goes offline. The result of downloading the map is a fully functional map using your styles, tiles, and other resources inside the downloaded region.</p>
<h3 id="limitations"><a class="markdownIt-Anchor" href="#limitations"></a> Limitations</h3>
<p>An app can download multiple regions for offline use, but the total offline download is capped at a maximum tile count “ceiling” across all downloaded regions. The tile ceiling is set to 6,000 tiles by default but can be raised <a href="https://www.mapbox.com/pricing/">for paid plans</a>. Use our <a href="https://www.mapbox.com/labs/offline-estimator/">Tile Count Estimator</a> to calculate the number of tiles required for your offline use case. Six thousand tiles cover a region roughly the size of Greater London within the M25 at zoom levels 0–15 or the contiguous United States at zoom levels 0–9. The size of these tiles on disk will vary according to the selected style.</p>
<p>The Maps SDK places no limit on the number of offline regions that may be created. Your Mapbox-powered application will reuse tiles and resources that are required by multiple regions, conserving network traffic and disk space.</p>
<p>The SDK also places no limit on the download speed of offline regions, nor to disk space used by offline resources. The limits will depend on the storage capacity of the mobile device and the speed of the network to which it is connected.</p>
<p>Our <a href="https://www.mapbox.com/tos/#%5BYmcMYmns%5D">terms of service</a> do not allow you or an end user to redistribute offline maps downloaded from Mapbox servers.</p>
<p>The offline regions will update themselves to the latest data automatically while your user is connected to the internet.</p>
<h3 id="defining-a-region"><a class="markdownIt-Anchor" href="#defining-a-region"></a> Defining a region</h3>
<p>Before a region can be used offline, the resources necessary for that region must be downloaded. Based on the parameters you specify when creating the region, the SDK calculates all resource requirements such as fonts, styles, and vector tiles covering the region. If more than one region in the offline database contains the fonts and styles, these will not be re-downloaded when another region’s downloaded.</p>
<p>First, you’ll need to get the <code>offlineManager</code> instance, define the region to download, and finally create the definition object. It’s important to note a few things:</p>
<ul>
<li>The offline map style <em>must</em> match the one being used for your <code>mapView</code>.</li>
<li>The definition needs the device’s screen density. It’s best to get this from the activities resources.</li>
<li>The bounds used for the download must not go over the 6,000 tile limit.</li>
</ul>
<pre class="hljs"><code><span class="hljs-comment">// Set up the OfflineManager</span>
offlineManager = OfflineManager.getInstance(SimpleOfflineMapActivity.<span class="hljs-keyword">this</span>);

<span class="hljs-comment">// Create a bounding box for the offline region</span>
LatLngBounds latLngBounds = <span class="hljs-keyword">new</span> LatLngBounds.Builder()
  .include(<span class="hljs-keyword">new</span> LatLng(<span class="hljs-number">37.7897</span>, -<span class="hljs-number">119.5073</span>)) <span class="hljs-comment">// Northeast</span>
  .include(<span class="hljs-keyword">new</span> LatLng(<span class="hljs-number">37.6744</span>, -<span class="hljs-number">119.6815</span>)) <span class="hljs-comment">// Southwest</span>
  .build();

<span class="hljs-comment">// Define the offline region</span>
OfflineTilePyramidRegionDefinition definition = <span class="hljs-keyword">new</span> OfflineTilePyramidRegionDefinition(
  mapboxMap.getStyleUrl(),
  latLngBounds,
  <span class="hljs-number">10</span>,
  <span class="hljs-number">20</span>,
  MainActivity.<span class="hljs-keyword">this</span>.getResources().getDisplayMetrics().density);
</code></pre>
<h4 id="metadata"><a class="markdownIt-Anchor" href="#metadata"></a> Metadata</h4>
<p>Providing a metadata object’s encouraged with at least a region name so that various regions your user’s download will be distinguishable. Besides the region name, you can store any arbitrary binary region information you’d like. The contents are opaque to the SDK implementation and won’t affect your offline region download, it only stores and retrieves a byte array.</p>
<pre class="hljs"><code><span class="hljs-comment">// Implementation that uses JSON to store Yosemite National Park as the offline region name.</span>
<span class="hljs-keyword">byte</span>[] metadata;
<span class="hljs-keyword">try</span> {
  JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject();
  jsonObject.put(JSON_FIELD_REGION_NAME, <span class="hljs-string">"Yosemite National Park"</span>);
  String json = jsonObject.toString();
  metadata = json.getBytes(JSON_CHARSET);
} <span class="hljs-keyword">catch</span> (Exception exception) {
  Log.e(TAG, <span class="hljs-string">"Failed to encode metadata: "</span> + exception.getMessage());
  metadata = <span class="hljs-keyword">null</span>;
}
</code></pre>
<p>Besides creating the metadata, you can also update the information stored, allowing your users, for example, to update the region name. The <code>offlineManager</code> object provides a method called <code>updateMetadata</code> which takes in both the updated metadata byte array and a callback to be notified when the update is completed, or an error occurs.</p>
<h3 id="download-a-region"><a class="markdownIt-Anchor" href="#download-a-region"></a> Download a region</h3>
<p>Now that the bounds and definition object are created, you can use the offlineManager to create an asynchronous download calling <code>createOfflineRegion</code>. You’ll need to pass in the definition and metadata objects we created in both the <a href="#defining-a-region">Defining a region</a> and <a href="#metadata">metadata</a> sections. This will provide you with two methods, <code>onCreate</code> and <code>onError</code>. onError occurs if an error starting or while downloading the region occurs. The <code>onCreate</code> method provides an <code>offlineRegion</code> object which you can use to check the download and even display the progress to your users. If you need to pause a download, you can use the <code>offlineRegion.setDownloadState()</code> to handle this.</p>
<pre class="hljs"><code><span class="hljs-comment">// Create the region asynchronously</span>
offlineManager.createOfflineRegion(definition, metadata,
  <span class="hljs-keyword">new</span> OfflineManager.CreateOfflineRegionCallback() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(OfflineRegion offlineRegion)</span> </span>{
      offlineRegion.setDownloadState(OfflineRegion.STATE_ACTIVE);

      <span class="hljs-comment">// Monitor the download progress using setObserver</span>
      offlineRegion.setObserver(<span class="hljs-keyword">new</span> OfflineRegion.OfflineRegionObserver() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStatusChanged</span><span class="hljs-params">(OfflineRegionStatus status)</span> </span>{

          <span class="hljs-comment">// Calculate the download percentage</span>
          <span class="hljs-keyword">double</span> percentage = status.getRequiredResourceCount() &gt;= <span class="hljs-number">0</span>
          ? (<span class="hljs-number">100.0</span> * status.getCompletedResourceCount() / status.getRequiredResourceCount()) :
          <span class="hljs-number">0.0</span>;

          <span class="hljs-keyword">if</span> (status.isComplete()) {
            <span class="hljs-comment">// Download complete</span>
            Log.d(TAG, <span class="hljs-string">"Region downloaded successfully."</span>);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.isRequiredResourceCountPrecise()) {
            Log.d(TAG, percentage);
          }
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(OfflineRegionError error)</span> </span>{
          <span class="hljs-comment">// If an error occurs, print to logcat</span>
          Log.e(TAG, <span class="hljs-string">"onError reason: "</span> + error.getReason());
          Log.e(TAG, <span class="hljs-string">"onError message: "</span> + error.getMessage());
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mapboxTileCountLimitExceeded</span><span class="hljs-params">(<span class="hljs-keyword">long</span> limit)</span> </span>{
          <span class="hljs-comment">// Notify if offline region exceeds maximum tile count</span>
          Log.e(TAG, <span class="hljs-string">"Mapbox tile count limit exceeded: "</span> + limit);
        }
      });
    }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(String error)</span> </span>{
    Log.e(TAG, <span class="hljs-string">"Error: "</span> + error);
  }
});
</code></pre>
<h3 id="managing-downloaded-regions"><a class="markdownIt-Anchor" href="#managing-downloaded-regions"></a> Managing downloaded regions</h3>
<p>Once you or your user has downloaded a region, the Maps SDK provides a few options to handle gathering list, positioning the camera inside the downloaded region, and a method for deletion of a region.</p>
<h4 id="list-offline-regions"><a class="markdownIt-Anchor" href="#list-offline-regions"></a> List offline regions</h4>
<p>The listing of regions is useful for presenting downloaded information to your user or gathering information inside the code itself. The <code>offlineManager</code> offers a <code>listOfflineRegions</code> method which provides both a method <code>onList</code> and <code>onError</code>. Use the <code>OfflineRegion</code> array to do all the actions in a specific region.</p>
<pre class="hljs"><code><span class="hljs-comment">// Get the region bounds and zoom and move the camera.</span>
LatLngBounds bounds = ((OfflineTilePyramidRegionDefinition)
  offlineRegions[regionSelected].getDefinition()).getBounds();
<span class="hljs-keyword">double</span> regionZoom = ((OfflineTilePyramidRegionDefinition)
  offlineRegions[regionSelected].getDefinition()).getMinZoom();

<span class="hljs-comment">// Create new camera position</span>
CameraPosition cameraPosition = <span class="hljs-keyword">new</span> CameraPosition.Builder()
  .target(bounds.getCenter())
  .zoom(regionZoom)
  .build();

<span class="hljs-comment">// Move camera to new position</span>
map.moveCamera(CameraUpdateFactory.newCameraPosition(cameraPosition));
</code></pre>
<h3 id="delete-region"><a class="markdownIt-Anchor" href="#delete-region"></a> Delete region</h3>
<p>To remove an offline region from the database, you’ll need to first receive the list of offline regions as explained in the <a href="#list-offline-regions">earlier section</a>. The <code>onList</code> method will provide you with an array of the present offline regions downloaded on the device, this object being the <code>offlineRegions</code>. You’ll then use this object to select the region to be deleted and call <code>delete</code> on it which will provide you with a callback to be notified when the region is successfully deleted or if an error occurs.</p>
<p>Deleting a region will result in also removing the least recently requested resources not required by other regions until the database shrinks below a certain size.</p>
<pre class="hljs"><code>offlineRegions[<span class="hljs-number">0</span>].delete(<span class="hljs-keyword">new</span> OfflineRegion.OfflineRegionDeleteCallback() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDelete</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// Once the region is deleted, remove the</span>
    <span class="hljs-comment">// progressBar and display a toast</span>
    progressBar.setVisibility(View.INVISIBLE);
    progressBar.setIndeterminate(<span class="hljs-keyword">false</span>);
    Toast.makeText(OfflineManagerActivity.<span class="hljs-keyword">this</span>, <span class="hljs-string">"Region deleted"</span>, Toast.LENGTH_LONG).show();
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(String error)</span> </span>{
    progressBar.setVisibility(View.INVISIBLE);
    progressBar.setIndeterminate(<span class="hljs-keyword">false</span>);
    Log.e(TAG, <span class="hljs-string">"Error: "</span> + error);
  }
});
</code></pre>
<!-- TODO ## Add inside a service -->
</div></div></div></div></div></div></div></div></div></div><script src="/android-docs/bundle.js?t=1496936133583"></script></body></html>