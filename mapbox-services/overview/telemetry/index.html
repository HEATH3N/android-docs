<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Telemetry | Android Documentation</title><meta name="type" data-type="enum" content="Android Documentation"/><meta name="title" data-type="string" content="Telemetry | Android Documentation"/><link href="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.min.css" rel="stylesheet"/><script async="" defer="" src="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.js"></script><link href="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.min.css" rel="stylesheet"/><script src="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.js"></script><link rel="stylesheet" href="stylesheet.css" type="text/css"/><style>.border--3{border-width:3px!important}.bg-green{background-color:#8cca44!important}.icon-android-green svg{color:#8cca44}.bright-blue-color{color:#0082ff}.border--gray-less-faint{border-color:#e8ebee!important}.hmax130 img{max-height:130px}.wmax260{max-width:260px}.text-decoration-none{text-decoration:none!important}.unstyled-list li{list-style-type:none!important}.overflow-y{overflow-y:auto}.t48{top:48px}.b0{bottom:0}.limiter{padding-left:24px;padding-right:24px;width:100%}@media (min-width:1200px){.limiter{padding-left:12.5%!important;padding-right:12.5%!important}}@media (min-width:440px){.note-card{margin-top:-12px;width:240px;margin-left:24px;padding-bottom:24px}}@media (max-width:640px){.mobile-left-nav{visibility:collapse;width:0;padding:0}}@media (max-width:640px){.mobile-right-nav{visibility:hidden;width:0;padding:0}}@media (min-width:640px){.nav-mobile{visibility:hidden}}@media (max-width:640px){.mobile-right-nav svg{visibility:visible}}@media (max-width:800px){.content{width:100%!important}}code p{font-weight:lighter;font-size:11px}code,pre{font-family:Fira Mono Medium,Monaco,monospace!important;font-weight:700!important;font-size:13px!important;word-break:normal!important}pre{background-color:#232323!important}.prose h1,h2,h3,h4,h5,h6{font-weight:400!important}.prose h3{margin-top:32px;border-top:1px solid rgba(198,210,225,.50196)}.prose h3:first-child{border-top:0}body .prose blockquote{border-left:5px solid #56adec;background-color:#fafafa;border-radius:2px;word-wrap:break-word;padding-top:12px;padding-bottom:12px;padding-right:12px}.toc{display:block!important;-ms-flex-negative:0!important;flex-shrink:0!important;-ms-flex-preferred-size:auto!important;flex-basis:auto!important;list-style-type:none;color:#273d56;position:fixed;top:42px;bottom:0;overflow-y:auto;padding-right:20px;padding-bottom:20px;padding-top:24px}@media (max-width:800px){.toc{visibility:hidden}}.toc-subheaders{font-size:12px;display:inline-block;line-height:20px;margin-bottom:12px}.page-hover:hover,.toc-subheaders a:hover{color:#0082ff}.nav-item:hover{color:#0082ff!important;border-color:#273d56}.doc-ul>.doc-ul-item:before{content:"";width:8px;height:8px;border-radius:2px;border:1px solid #1f3349;opacity:.4;position:absolute;margin:9px 0 0 -20px}.doc-ol{counter-reset:listItem}.doc-ol>.doc-ol-item{margin:3px 0}ol li{list-style-type:none}ol li:before{counter-increment:listItem;content:counter(listItem);font-size:12px;border-radius:3px;padding:1px 6px;border:1px solid #c6d2e1;margin-right:12px}.hljs{color:#a9b7c6;background:#232323;display:block;overflow-x:auto;padding:.5em}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#56b881}.hljs-comment,.hljs-quote{color:gray}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#56b881}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><div id="react-mount"><div class="grid" data-reactroot="" data-reactid="1" data-react-checksum="820085306"><div class="z1 min48 flex-parent--center-main flex-parent w-full border-b border-t bg-white border--gray-less-faint fixed" data-reactid="2"><div class="wmax1200 w-full pl24 pr24 flex-parent--space-between-main flex-parent" data-reactid="3"><div class="flex-child col col--6 inline-block" data-reactid="4"><div class="txt-s mobile-left-nav py12 bg-transparent btn px0 color-gray-light" data-reactid="5"><strong data-reactid="6">Platform</strong></div><div class="txt-s py12 bg-transparent btn  color-gray-dark" data-reactid="7"><strong data-reactid="8">Android</strong></div><div class="txt-s mobile-left-nav py12 bg-transparent btn px0 color-gray-light" data-reactid="9"><strong data-reactid="10">Product</strong></div><div style="display:inline-block;" data-reactid="11"><button class="txt-s py12 nav-item bg-transparent btn flex-parent flex-parent--center-cross color-gray-dark" data-reactid="12"><strong data-reactid="13"><!-- react-text: 14 --><!-- /react-text --><!-- react-text: 15 --><!-- /react-text --><!-- react-text: 16 -->Mapbox Services<!-- /react-text --><!-- react-text: 17 --><!-- /react-text --></strong><svg class="icon" data-reactid="18"><use href="#icon-chevron-down" data-reactid="19"></use></svg></button></div></div><div class="flex-child col col--6 flex-parent flex-parent--end-main" data-reactid="20"><div style="display:inherit;" data-reactid="21"><button class="block flex-parent flex-parent--center-cross" data-reactid="22"><svg class="icon--l nav-mobile color-gray-dark opacity75" data-reactid="23"><use href="#icon-menu" data-reactid="24"></use></svg></button></div><a class="py12 transition mobile-right-nav unround btn color-gray-dark nav-item bg-transparent txt-s  border-b border--3" href="/android-docs/mapbox-services/overview/" data-reactid="25">Overview</a><a class="py12 transition mobile-right-nav unround btn color-gray-dark nav-item bg-transparent txt-s  " href="/android-docs/mapbox-services/examples/" data-reactid="26">Examples</a><!-- react-text: 27 --><!-- /react-text --></div></div></div><div class="scroll-styled flex-parent--center-main flex-parent limiter pb96 pl24 pr24 pt24 overflow-y t48 b0 fixed flex-child" data-reactid="28"><div class="flex-parent--space-between-main flex-parent" data-reactid="29"><div class="col--3 pt42 col toc flex-child--no-shrink  scroll-styled" data-reactid="30"><div data-reactid="31"><li class="txt-bold txt-fancy" data-reactid="32"><a class="page-hover text-decoration-none" href="/android-docs/mapbox-services/overview/" data-reactid="33">Mapbox Services</a></li><!-- react-text: 34 --><!-- /react-text --></div><div data-reactid="35"><li class="txt-bold txt-fancy" data-reactid="36"><a class="page-hover text-decoration-none" href="/android-docs/mapbox-services/overview/directions-matrix/" data-reactid="37">Directions Matrix</a></li><!-- react-text: 38 --><!-- /react-text --></div><div data-reactid="39"><li class="txt-bold txt-fancy" data-reactid="40"><a class="page-hover text-decoration-none" href="/android-docs/mapbox-services/overview/geocoder/" data-reactid="41">Geocoder</a></li><!-- react-text: 42 --><!-- /react-text --></div><div data-reactid="43"><li class="txt-bold txt-fancy" data-reactid="44"><a class="page-hover text-decoration-none" href="/android-docs/mapbox-services/overview/static-image/" data-reactid="45">Static Image</a></li><!-- react-text: 46 --><!-- /react-text --></div><div data-reactid="47"><li class="txt-bold txt-fancy" data-reactid="48"><a class="page-hover text-decoration-none" href="/android-docs/mapbox-services/overview/telemetry/" data-reactid="49"><div class="bright-blue-color" data-reactid="50">Telemetry</div></a></li><div class="ml6 pt6" data-reactid="51"><ul class="toc-subheaders">
<li><a href="#permissionsmanager">PermissionsManager</a>
<ul>
<li><a href="#permissionslistener">PermissionsListener</a></li>
</ul>
</li>
<li><a href="#locationengine">LocationEngine</a>
<ul>
<li><a href="#getting-location-updates">Getting location updates</a></li>
<li><a href="#last-location">Last location</a></li>
<li><a href="#mock-location-engine">Mock Location Engine</a></li>
</ul>
</li>
</ul>
</div></div><div style="display:inline-block;" data-reactid="52"><button class="txt-fancy page-hover" data-reactid="53"><strong data-reactid="54">API Reference</strong></button></div></div><div data-reactid="55"><div class="prose color-gray-dark" data-reactid="56"><div class="content col--9 col col--offl3" data-reactid="57"><div class="pt12 doc-ul pb96 doc-ol wmax1200 doc-ol-item" data-reactid="58"><div class="markdown" data-reactid="59"><div data-reactid="60"><h1 id="telemetry"><a class="markdownIt-Anchor" href="#telemetry"></a> Telemetry</h1>
<p>The telemetry library includes many utilities, such as <code>locationEngine</code> or <code>permissionManager</code>, that you can use in your projects. The Telemetry module has no dependencies on any of the other Mapbox-Java modules and only depends on having the Android API plugin inside your project.</p>
<blockquote>
<p>Find out more about telemetry on <a href="https://www.mapbox.com/telemetry/">our website</a></p>
</blockquote>
<h2 id="permissionsmanager"><a class="markdownIt-Anchor" href="#permissionsmanager"></a> PermissionsManager</h2>
<p>Your application will need to request permission during runtime, if your Android project is built targeting API level 23 or higher. Handling this directly in your activity produces a bunch of boilerplate and can oftentimes be hard to get correct. That’s where the PermissionsManager comes into play. With the PermissionsManager, you can check whether the user has granted location permission and request permissions if the user hasn’t granted them yet.</p>
<p>You’ll notice that once you have set up your permission manager, you will still need to override your activity’s <code>onRequestPermissionsResult</code> and call the permissionsManagers same method.</p>
<blockquote>
<p><strong>Note:</strong> The PermissionsManager can be used for requesting additional permissions and not only location.</p>
</blockquote>
<pre class="hljs"><code>permissionsManager = <span class="hljs-keyword">new</span> PermissionsManager(&lt;a <span class="hljs-keyword">new</span> PermissionsListener&gt;);
<span class="hljs-keyword">if</span> (!permissionsManager.areLocationPermissionsGranted(<span class="hljs-keyword">this</span>)) {
  permissionsManager.requestLocationPermissions(<span class="hljs-keyword">this</span>);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(
<span class="hljs-keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="hljs-keyword">int</span>[] grantResults)</span> </span>{
  permissionsManager.onRequestPermissionsResult(requestCode, permissions, grantResults);
}
</code></pre>
<h3 id="permissionslistener"><a class="markdownIt-Anchor" href="#permissionslistener"></a> PermissionsListener</h3>
<p>The permissionsListener needs to also be set up and passed into the PermissionsManager constructor. You’ll notice that it overrides two methods, <code>onExplanationNeeded</code> and <code>onPermissionResult</code>. An explanation isn’t required but strongly encouraged to allow the user to understand why you are requesting this permission.</p>
<p>The permission result is invoked once the user decides whether to allow or deny the permission. A boolean value is given, which you can use to write an if statement. Both cases should be handled correctly. Continue with your permission sensitive logic if the user approves. Otherwise, if the user denies, it’s good to display a message which tells the user that permission is required for your application to work.</p>
<pre class="hljs"><code>PermissionsListener permissionsListener = <span class="hljs-keyword">new</span> PermissionsListener() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onExplanationNeeded</span><span class="hljs-params">(List&lt;String&gt; permissionsToExplain)</span> </span>{

  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPermissionResult</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> granted)</span> </span>{
    <span class="hljs-keyword">if</span> (granted) {
      <span class="hljs-comment">// Permission sensitive logic called here</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// User denied the permission</span>
    }
  }
};
</code></pre>
<h2 id="locationengine"><a class="markdownIt-Anchor" href="#locationengine"></a> LocationEngine</h2>
<p>If your application needs location information, the <code>locationEngine</code> can help you get this information while also simplifying the process and being flexible enough to use different services. The LocationEngine found in the telemetry module now supports the following location providers:</p>
<ul>
<li><a href="https://github.com/mapzen/lost/">LOST</a></li>
<li>Google Play Services</li>
<li>Android Location</li>
<li>Mock Location Engine</li>
</ul>
<blockquote>
<p><strong>Note:</strong> if you are using our Android Maps SDK, you can also set the locationEngine equal to the <code>LocationSource.getLocationEngine(this);</code> and it will use the same location engine used by the maps SDK. This eliminates the need to create a new locationEngine from scratch.</p>
</blockquote>
<h3 id="getting-location-updates"><a class="markdownIt-Anchor" href="#getting-location-updates"></a> Getting location updates</h3>
<p>To start off, it’s required to either include the mapbox-android-services or copy over the <a href="https://github.com/mapbox/mapbox-java/blob/master/mapbox/libandroid-services/src/main/java/com/mapbox/services/android/location/LostLocationEngine.java">LostLocationEngine class</a> into your project. You’ll then want to initialize a new instance of LocationEngine, activate it, and optionally add a location listener. Inside the <code>onConnected</code> you can begin requesting for location updates or wait for the proper time to do so.</p>
<pre class="hljs"><code>LocationEngine locationEngine = LostLocationEngine.getLocationEngine(<span class="hljs-keyword">this</span>);
locationEngine.activate();
locationEngine.addLocationEngineListener(<span class="hljs-keyword">new</span> LocationEngineListener() {
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConnected</span><span class="hljs-params">()</span> </span>{
    locationEngine.requestLocationUpdates();
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLocationChanged</span><span class="hljs-params">(Location location)</span> </span>{

  }
});
</code></pre>
<p>To prevent your application from having a memory leak, it is a good idea to stop requesting location updated inside your activity’s <code>onStop</code> method and continue requesting them in <code>onStart</code>.</p>
<h3 id="last-location"><a class="markdownIt-Anchor" href="#last-location"></a> Last location</h3>
<p>If your application needs to quickly get a user location, you can call the <code>getLastLocation</code> which will return the user’s last position. You can then use the location object returned to decide the timing the location was given.</p>
<blockquote>
<p><strong>Note:</strong> Careful with requesting the users last location since the location has the possibility of being null.</p>
</blockquote>
<pre class="hljs"><code>Location lastLocation = locationEngine.getLastLocation();
<span class="hljs-keyword">if</span> (lastLocation != <span class="hljs-keyword">null</span>) {
  <span class="hljs-comment">// Location logic here</span>
}
</code></pre>
<h3 id="mock-location-engine"><a class="markdownIt-Anchor" href="#mock-location-engine"></a> Mock Location Engine</h3>
<!-- preview -->
<p>Not implemented in SDK yet.</p>
</div></div></div></div></div></div></div></div></div></div><script src="/android-docs/bundle.js?t=1496254323373"></script></body></html>