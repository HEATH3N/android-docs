<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Location Layer | Android Documentation</title><meta class="swiftype" name="type" data-type="enum" content="Android Documentation"/><meta class="swiftype" name="title" data-type="string" content="Location Layer | Android Documentation"/><link href="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.min.css" rel="stylesheet"/><script async="" defer="" src="https://api.mapbox.com/mapbox-assembly/v0.12.0/assembly.js"></script><link href="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.min.css" rel="stylesheet"/><script src="https://api.mapbox.com/mapbox-assembly/mapbox-addon/v0.10.0/assembly.js"></script><link rel="stylesheet" href="stylesheet.css" type="text/css"/><style>.border--3{border-width:3px!important}.bg-green{background-color:#8cca44!important}.icon-android-green svg{color:#8cca44}.bright-blue-color{color:#0082ff}.bright-blue-color-on-hover:hover{color:#0082ff!important}.border--bright-blue-color{border-color:#273d56}.border--gray-less-faint{border-color:#e8ebee!important}.bright-blue-color-on-hover-anchor a:hover{color:#0082ff}.hmax130 img{max-height:130px}.wmax260{max-width:260px}.text-decoration-none{text-decoration:none!important}.unstyled-list li{list-style-type:none!important}.overflow-y{overflow-y:auto}.t48{top:48px}.b0{bottom:0}.txt-ms{font-size:13px!important;line-height:18px}td,th{text-align:left!important;padding:4px!important;font-size:12px!important}th{background-color:#e8ebee}code,pre,td{font-weight:400!important;font-size:12px!important}.limiter{padding-left:24px;padding-right:24px;width:100%}@media (min-width:1200px){.limiter{padding-left:12.5%!important;padding-right:12.5%!important}}.prose h1,h2,h3,h4,h5,h6{font-weight:400!important}@media (min-width:440px){.note-card{margin-top:-12px;width:240px;margin-left:24px;padding-bottom:0!important}}.note-card{padding-bottom:24px}code{font-weight:400}code,pre{font-family:Fira Mono Medium,Monaco,monospace!important}code,pre{font-size:12px!important;word-break:normal!important}pre{font-weight:700;background-color:#232323!important}.doc-ul>.doc-ul-item:before{content:"";width:8px;height:8px;border-radius:2px;border:1px solid #1f3349;opacity:.4;position:absolute;margin:9px 0 0 -20px}.doc-ol{counter-reset:listItem}.doc-ol>.doc-ol-item{margin:3px 0}ol li{list-style-type:none}ol li:before{counter-increment:listItem;content:counter(listItem);font-size:12px;border-radius:3px;padding:1px 6px;border:1px solid #c6d2e1;margin-right:12px}.hljs{color:#a9b7c6;background:#232323;display:block;overflow-x:auto;padding:.5em}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#56b881}.hljs-comment,.hljs-quote{color:gray}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#56b881}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><div id="react-mount"><div class="grid" data-reactroot="" data-reactid="1" data-react-checksum="801580110"><div class="z1 h48 flex-parent--center-main flex-parent w-full border-b border-t bg-white border--gray-less-faint fixed" data-reactid="2"><div class="wmax1200 w-full pl24 pr24 flex-parent--space-between-main flex-parent" data-reactid="3"><div class="flex-child col col--6 inline-block" data-reactid="4"><div class="txt-s py12 bg-transparent btn px0 color-gray-light" data-reactid="5"><strong data-reactid="6">Platform</strong></div><div style="display:inline-block;" data-reactid="7"><button class="txt-s py12 border--bright-blue-color bright-blue-color-on-hover bg-transparent btn flex-parent flex-parent--center-cross color-gray-dark" data-reactid="8"><strong data-reactid="9">Android</strong><svg class="icon" data-reactid="10"><use xlink:href="#icon-chevron-down" data-reactid="11"></use></svg></button></div><div class="txt-s py12 bg-transparent btn px0 color-gray-light" data-reactid="12"><strong data-reactid="13">Product</strong></div><div style="display:inline-block;" data-reactid="14"><button class="txt-s py12 border--bright-blue-color bright-blue-color-on-hover bg-transparent btn flex-parent flex-parent--center-cross color-gray-dark" data-reactid="15"><strong data-reactid="16">Plugins</strong><svg class="icon" data-reactid="17"><use xlink:href="#icon-chevron-down" data-reactid="18"></use></svg></button></div></div><div class="flex-child col col--6 flex-parent flex-parent--end-main" data-reactid="19"><a class="py12 transition mobile-right-nav unround btn color-gray-dark border--bright-blue-color bright-blue-color-on-hover bg-transparent txt-s  border-b border--3" href="/android-docs/plugins/overview/" data-reactid="20">Overview</a><a class="py12 transition mobile-right-nav unround btn color-gray-dark border--bright-blue-color bright-blue-color-on-hover bg-transparent txt-s  " href="/android-docs/plugins/examples/" data-reactid="21">Examples</a><!-- react-text: 22 --><!-- /react-text --></div></div></div><div class="scroll-styled flex-parent--center-main flex-parent limiter pb96 pl24 pr24 pt24 overflow-y t48 b0 fixed flex-child" data-reactid="23"><div class="flex-parent--space-between-main flex-parent" data-reactid="24"><div class="col col--2 pt42 pr18 pb18 flex-child--no-shrink fixed color-gray-dark unstyled-list scroll-styled" data-reactid="25"><div data-reactid="26"><li class="txt-bold txt-fancy" data-reactid="27"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/plugins/overview/" data-reactid="28">Mapbox Plugins</a></li><!-- react-text: 29 --><!-- /react-text --></div><div data-reactid="30"><li class="txt-bold txt-fancy" data-reactid="31"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/plugins/overview/building/" data-reactid="32">Building</a></li><!-- react-text: 33 --><!-- /react-text --></div><div data-reactid="34"><li class="txt-bold txt-fancy" data-reactid="35"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/plugins/overview/location-layer/" data-reactid="36"><div class="bright-blue-color" data-reactid="37">Location Layer</div></a></li><div class="ml6 pt6" data-reactid="38"><ul class="txt-s inline-block mb12 bright-blue-color-on-hover-anchor">
<li>
<ul>
<li><a href="#setup-permissions">Setup permissions</a></li>
<li><a href="#lifecycles">Lifecycles</a></li>
<li><a href="#add-the-location-layer">Add the location layer</a></li>
<li><a href="#usage-with-navigation">Usage with navigation</a></li>
<li><a href="#customization">Customization</a></li>
</ul>
</li>
</ul>
</div></div><div data-reactid="39"><li class="txt-bold txt-fancy" data-reactid="40"><a class="bright-blue-color-on-hover text-decoration-none" href="/android-docs/plugins/overview/traffic/" data-reactid="41">Traffic</a></li><!-- react-text: 42 --><!-- /react-text --></div><!-- react-text: 43 --><!-- /react-text --><div style="display:inline-block;" data-reactid="44"><button class="txt-fancy bright-blue-color-on-hover" data-reactid="45"><strong data-reactid="46">API Reference</strong></button></div><!-- react-text: 47 --><!-- /react-text --><!-- react-text: 48 --><!-- /react-text --></div><div data-reactid="49"><div class="prose color-gray-dark" data-reactid="50"><div class="content col--9 col col--offl3" data-reactid="51"><div class="pt12 doc-ul doc-ol pb96 wmax1200 doc-ol-item" data-reactid="52"><div class="markdown" data-reactid="53"><div data-reactid="54"><h1 id="location-layer"><a class="markdownIt-Anchor" href="#location-layer"></a> Location Layer</h1>
<p>A popular, often critical feature is showing the users current location as an annotation to give a reference point on the map. This plugin makes use of the latest <a href="/android-docs/map-sdk/overview/runtime-styling/">runtime styling</a> features to display the location icons/markers within the map itself rather than on top as an Android view. This brings several fixes and performance improvements previously experienced when using the now deprecated <code>MyLocationView</code>.</p>
<p>To install, head over to the <a href="/android-docs/plugins/overview/">Mapbox Plugin Overview</a> page which will walk you through adding the dependency.</p>
<h3 id="setup-permissions"><a class="markdownIt-Anchor" href="#setup-permissions"></a> Setup permissions</h3>
<p>Before using the location layer plugin, you’ll need to include either the coarse <em>or</em> fine location permission inside your applications manifest.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">package</span>=<span class="hljs-string">"com.example.myapp"</span> &gt;</span>
  ...
  <span class="hljs-comment">&lt;!-- Coarse location --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span>

  <span class="hljs-comment">&lt;!-- Or fine location --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>If your application’s targeting Android 6.0 (API 23) or higher, you’ll want to use the new permissions model which request permissions at runtime rather than during the installation process. It’s important to request the permission either during the application startup or when the location layer gets initialized. <a href="/android-docs/mapbox-services/overview/telemetry/#permissionsmanager">PermissionsManager</a> is a utility offered as part of the Mapbox Services package inside the Map SDK and streamlines the permission request process.</p>
<h3 id="lifecycles"><a class="markdownIt-Anchor" href="#lifecycles"></a> Lifecycles</h3>
<p>It’s important to include the location layer <code>onStart()</code> and <code>onStop()</code> lifecycle events in their respective activity methods. This prevents memory leaks from occurring and reduces battery consumption. The plugin has support for the new <code>LifecycleObserver</code> APIs, by adding the plugin as a lifecycle observer in your activity, you won’t need to handle the lifecycles manually.</p>
<h3 id="add-the-location-layer"><a class="markdownIt-Anchor" href="#add-the-location-layer"></a> Add the location layer</h3>
<p>To initialize the Location layer plugin, you’ll need to pass in both the map view and the <code>mapboxMap</code> object. Depending on whether or not you’d like the Location Layer to track the user’s location automatically or not, you can either pass in a locationEngine or <code>null</code>. If no location engines provided, you are responsible for updating the location position manually using <code>forceLocationUpdate()</code>.</p>
<pre class="hljs"><code>locationLayerPlugin = <span class="hljs-keyword">new</span> LocationLayerPlugin(mapView, mapboxMap, locationEngine);
</code></pre>
<p>There are several location layer modes inside the plugin which are useful for different app needs. Once the plugin’s initialized, you’ll want to enable it by setting the location mode through <code>setLocationLayerEnabled()</code> passing in the mode type. A table’s provided below with a short description of each state the location layer can be in at any given time. When first initialized the default state will be <code>NONE</code>.</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NONE</code></td>
<td>The default state when the plugins first initialized, locations not shown on the map and location events get ignored.</td>
</tr>
<tr>
<td><code>TRACKING</code></td>
<td>Displays a blue icon by default which marks the devices current location. An accuracy ring’s also drawn on the map.</td>
</tr>
<tr>
<td><code>COMPASS</code></td>
<td>Identical to the tracking mode except a compass listeners attached which displays on the map as a chevron/arrow icon surrounding the default blue icon.</td>
</tr>
<tr>
<td><code>NAVIGATION</code></td>
<td>A unique marker icon specific to a navigation session. By default, this icon’s larger and has an arrow centered pointing in the location bearing direction. No accuracy ring’s shown in this mode.</td>
</tr>
</tbody>
</table>
<h3 id="usage-with-navigation"><a class="markdownIt-Anchor" href="#usage-with-navigation"></a> Usage with navigation</h3>
<p>Another difference between the Location Layer plugin versus the <code>MyLocationView</code> is the inclusion of support for navigation usage. Once a navigation session’s started using the <a href="/android-docs/navigation/overview/">Mapbox Navigation SDK</a>, a few adjustments will need to be made to the Location Layer plugin to improve the performance and behavior. First, the mode must be changed to <code>NAVIGATION</code> so the icon displays and works in the most optimal way.</p>
<p>If you plan to use the snapped location provided by the navigation SDK, you’ll need to use <code>locationLayerPlugin.setLocationEngine()</code> to <code>null</code> to prevent location coordinates that aren’t snapped to update the icon location. Instead, you’ll need to add <code>forceLocationUpdate()</code> inside the navigation SDKs <code>onProgressChange()</code> callback which <em>does</em> provided the snapped location.</p>
<p>Once a navigation sessions complete, you can return to the plugin’s previous state by passing back in your locationEngine and changing the mode back to the previous mode.</p>
<h3 id="customization"><a class="markdownIt-Anchor" href="#customization"></a> Customization</h3>
<p>The plugin allows for several customizations such as drawables, opacities, and more by passing in a style either while constructing the plugin or using the provided <code>applyStyle()</code> API. For example, if you’d like to change the location layer icon from the default blue to red, I’d first need to generate a new icon drawable showing the change, add the drawable to my project, and then create a new style with the parentLayout being <code>LocationLayer</code>. The snippet below shows all the currently customizable attributes.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CustomLocationLayer"</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">"LocationLayer"</span>&gt;</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"foregroundDrawable"</span>&gt;</span>@drawable/custom_user_icon<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"backgroundDrawable"</span>&gt;</span>@drawable/mapbox_user_stroke_icon<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bearingDrawable"</span>&gt;</span>@drawable/mapbox_user_bearing_icon<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"navigationDrawable"</span>&gt;</span>@drawable/mapbox_user_puck_icon<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accuracyAlpha"</span>&gt;</span>0.15<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accuracyColor"</span>&gt;</span>@color/mapbox_plugin_location_layer_blue<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</div></div></div></div></div></div></div></div></div></div><script src="/android-docs/bundle.js?t=1500492478865"></script></body></html>